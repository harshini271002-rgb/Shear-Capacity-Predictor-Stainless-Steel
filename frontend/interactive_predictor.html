<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Shear Capacity Predictor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .card h2 {
            margin-bottom: 20px;
            color: #667eea;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .beam-diagram {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .beam-diagram img {
            max-width: 100%;
            height: auto;
        }

        .dimension-labels {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .dimension-item {
            background: white;
            padding: 10px;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }

        .dimension-item .label {
            font-size: 0.85rem;
            color: #666;
        }

        .dimension-item .value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .results-section {
            display: none;
        }

        .results-section.show {
            display: block;
        }

        .result-banner {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
        }

        .result-banner h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .result-banner .value {
            font-size: 3rem;
            font-weight: bold;
        }

        .result-banner .unit {
            font-size: 1.5rem;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .metric-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #667eea;
        }

        .metric-box .label {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 5px;
        }

        .metric-box .value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }

        .failure-mode {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .failure-mode h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .failure-mode .mode {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
        }

        .importance-chart {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }

        .importance-bar {
            margin-bottom: 15px;
        }

        .importance-bar .label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .importance-bar .bar {
            height: 25px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            position: relative;
            transition: width 0.5s ease;
        }

        .importance-bar .percentage {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-weight: bold;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .comparison-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .comparison-table tr:hover {
            background: #f5f5f5;
        }

        .highlight {
            background: #e8f5e9 !important;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üîß Interactive Shear Capacity Predictor</h1>
            <p>Lipped Channel Beam with Perforation - ML Analysis</p>
        </div>

        <div class="main-grid">
            <!-- LEFT: INPUT SECTION -->
            <div class="card">
                <h2>üìù Input Parameters</h2>

                <div class="beam-diagram">
                    <h3 style="margin-bottom: 15px;">Lipped Channel Beam Geometry</h3>
                    <svg width="100%" height="300" viewBox="0 0 400 300">
                        <!-- Channel beam cross-section -->
                        <rect x="50" y="50" width="20" height="200" fill="#4a90e2" stroke="#2c3e50" stroke-width="2" />
                        <rect x="50" y="50" width="120" height="20" fill="#4a90e2" stroke="#2c3e50" stroke-width="2" />
                        <rect x="150" y="50" width="20" height="40" fill="#4a90e2" stroke="#2c3e50" stroke-width="2" />
                        <rect x="50" y="230" width="120" height="20" fill="#4a90e2" stroke="#2c3e50" stroke-width="2" />
                        <rect x="150" y="210" width="20" height="40" fill="#4a90e2" stroke="#2c3e50" stroke-width="2" />

                        <!-- Web perforation -->
                        <circle cx="60" cy="150" r="30" fill="white" stroke="#e74c3c" stroke-width="3" />

                        <!-- Dimension lines -->
                        <line x1="180" y1="50" x2="180" y2="250" stroke="#e74c3c" stroke-width="2"
                            marker-end="url(#arrowred)" />
                        <text x="190" y="155" fill="#e74c3c" font-weight="bold">D</text>

                        <line x1="50" y1="270" x2="170" y2="270" stroke="#27ae60" stroke-width="2"
                            marker-end="url(#arrowgreen)" />
                        <text x="100" y="290" fill="#27ae60" font-weight="bold">b</text>

                        <line x1="30" y1="150" x2="30" y2="90" stroke="#9b59b6" stroke-width="2" />
                        <text x="10" y="120" fill="#9b59b6" font-weight="bold">dwh</text>

                        <defs>
                            <marker id="arrowred" markerWidth="10" markerHeight="10" refX="5" refY="3" orient="auto"
                                fill="#e74c3c">
                                <polygon points="0 0, 10 3, 0 6" />
                            </marker>
                            <marker id="arrowgreen" markerWidth="10" markerHeight="10" refX="5" refY="3" orient="auto"
                                fill="#27ae60">
                                <polygon points="0 0, 10 3, 0 6" />
                            </marker>
                        </defs>
                    </svg>
                    <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                        Cross-section of lipped channel beam with circular web opening
                    </p>
                </div>

                <div class="input-grid">
                    <div class="form-group">
                        <label>Opening Ratio (dwh/d1)</label>
                        <input type="number" step="0.01" id="dwh_d1" value="0.4" onchange="updateDimensions()">
                    </div>
                    <div class="form-group">
                        <label>d1 (mm)</label>
                        <input type="number" step="0.01" id="d1" value="144" onchange="updateDimensions()">
                    </div>
                    <div class="form-group">
                        <label>tw - Web Thickness (mm)</label>
                        <input type="number" step="0.01" id="tw" value="1.5" onchange="updateDimensions()">
                    </div>
                    <div class="form-group">
                        <label>Flange Width (mm)</label>
                        <input type="number" step="0.01" id="flange_width" value="60" onchange="updateDimensions()">
                    </div>
                    <div class="form-group">
                        <label>Total Depth D (mm)</label>
                        <input type="number" step="0.01" id="total_depth" value="150" onchange="updateDimensions()">
                    </div>
                    <div class="form-group">
                        <label>fyw - Yield Strength (MPa)</label>
                        <input type="number" step="0.01" id="fyw" value="349.1" onchange="updateDimensions()">
                    </div>
                    <div class="form-group">
                        <label>E - Young's Modulus (MPa)</label>
                        <input type="number" step="0.01" id="E" value="210000" onchange="updateDimensions()">
                    </div>
                    <div class="form-group">
                        <label>a/d - Aspect Ratio</label>
                        <input type="number" step="0.01" id="a_d" value="1.0" onchange="updateDimensions()">
                    </div>
                </div>

                <div class="dimension-labels" id="current-dimensions">
                    <!-- Updated dynamically -->
                </div>

                <button onclick="predictShear()" style="margin-top: 20px;">üîÆ Predict Shear Capacity</button>
            </div>

            <!-- RIGHT: RESULTS SECTION -->
            <div class="card results-section" id="results">
                <h2>üìä Prediction Results</h2>

                <div class="result-banner">
                    <h3>Predicted Shear Capacity</h3>
                    <div class="value" id="capacity-value">-</div>
                    <div class="unit">kN</div>
                </div>

                <div class="metrics-grid">
                    <div class="metric-box">
                        <div class="label">Model Used</div>
                        <div class="value" style="font-size: 1.2rem;">SVR</div>
                    </div>
                    <div class="metric-box">
                        <div class="label">R¬≤ Score</div>
                        <div class="value">0.9952</div>
                    </div>
                    <div class="metric-box">
                        <div class="label">MAPE</div>
                        <div class="value">4.22%</div>
                    </div>
                    <div class="metric-box">
                        <div class="label">MAE</div>
                        <div class="value">2.98 kN</div>
                    </div>
                </div>

                <div class="failure-mode">
                    <h4>‚ö†Ô∏è Predicted Failure Mode</h4>
                    <div class="mode" id="failure-mode">-</div>
                    <p style="margin-top: 10px; font-size: 0.9rem;" id="failure-description">-</p>
                </div>

                <h3 style="margin-top: 25px; margin-bottom: 15px;">üéØ Feature Importance - What Influences Capacity?
                </h3>
                <div class="importance-chart">
                    <div class="importance-bar">
                        <div class="label">
                            <span>d1 (Web Depth)</span>
                            <span>High Influence</span>
                        </div>
                        <div class="bar" style="width: 85%;">
                            <span class="percentage">85%</span>
                        </div>
                    </div>

                    <div class="importance-bar">
                        <div class="label">
                            <span>tw (Web Thickness)</span>
                            <span>High Influence</span>
                        </div>
                        <div class="bar" style="width: 78%;">
                            <span class="percentage">78%</span>
                        </div>
                    </div>

                    <div class="importance-bar">
                        <div class="label">
                            <span>fyw (Yield Strength)</span>
                            <span>Medium Influence</span>
                        </div>
                        <div class="bar" style="width: 52%;">
                            <span class="percentage">52%</span>
                        </div>
                    </div>

                    <div class="importance-bar">
                        <div class="label">
                            <span>dwh/d1 (Opening Ratio)</span>
                            <span>Medium Influence</span>
                        </div>
                        <div class="bar" style="width: 45%;">
                            <span class="percentage">45%</span>
                        </div>
                    </div>

                    <div class="importance-bar">
                        <div class="label">
                            <span>Flange Width</span>
                            <span>Low Influence</span>
                        </div>
                        <div class="bar" style="width: 28%;">
                            <span class="percentage">28%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- COMPARISON TABLE -->
        <div class="card">
            <h2>üìà Model Performance Comparison</h2>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Model</th>
                        <th>R¬≤ Score</th>
                        <th>MAPE (%)</th>
                        <th>MSE</th>
                        <th>MAE</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="highlight">
                        <td><strong>SVR (Current)</strong></td>
                        <td>0.9952</td>
                        <td>4.22</td>
                        <td>5.88</td>
                        <td>1.91</td>
                    </tr>
                    <tr>
                        <td>MLP Neural Network</td>
                        <td>0.9941</td>
                        <td>4.16</td>
                        <td>7.32</td>
                        <td>1.96</td>
                    </tr>
                    <tr>
                        <td>XGBoost</td>
                        <td>0.9761</td>
                        <td>8.24</td>
                        <td>29.52</td>
                        <td>3.43</td>
                    </tr>
                    <tr>
                        <td>Gradient Boosting</td>
                        <td>0.9656</td>
                        <td>8.95</td>
                        <td>42.49</td>
                        <td>4.08</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        function updateDimensions() {
            const dwh_d1 = parseFloat(document.getElementById('dwh_d1').value) || 0;
            const d1 = parseFloat(document.getElementById('d1').value) || 0;
            const tw = parseFloat(document.getElementById('tw').value) || 0;
            const D = parseFloat(document.getElementById('total_depth').value) || 0;

            const dwh = dwh_d1 * d1;

            const html = `
                <div class="dimension-item">
                    <div class="label">Opening Depth (dwh)</div>
                    <div class="value">${dwh.toFixed(2)} mm</div>
                </div>
                <div class="dimension-item">
                    <div class="label">Web Depth (d1)</div>
                    <div class="value">${d1.toFixed(2)} mm</div>
                </div>
                <div class="dimension-item">
                    <div class="label">Web Thickness (tw)</div>
                    <div class="value">${tw.toFixed(2)} mm</div>
                </div>
                <div class="dimension-item">
                    <div class="label">Total Depth (D)</div>
                    <div class="value">${D.toFixed(2)} mm</div>
                </div>
            `;

            document.getElementById('current-dimensions').innerHTML = html;
        }

        function determineFailureMode(capacity, opening_ratio) {
            if (opening_ratio === 0) {
                return {
                    mode: "Shear Yielding",
                    description: "No web opening - failure by shear yielding of the web"
                };
            } else if (opening_ratio < 0.3) {
                return {
                    mode: "Shear Buckling (Local)",
                    description: "Small opening - local shear buckling around perforation"
                };
            } else if (opening_ratio < 0.6) {
                return {
                    mode: "Vierendeel Mechanism",
                    description: "Medium opening - Vierendeel bending mechanism governs"
                };
            } else {
                return {
                    mode: "Web-Post Buckling",
                    description: "Large opening - web-post buckling between opening and support"
                };
            }
        }

        async function predictShear() {
            const inputs = {
                dwh_d1: parseFloat(document.getElementById('dwh_d1').value),
                d1: parseFloat(document.getElementById('d1').value),
                tw: parseFloat(document.getElementById('tw').value),
                flange_width: parseFloat(document.getElementById('flange_width').value),
                total_depth: parseFloat(document.getElementById('total_depth').value),
                fyw: parseFloat(document.getElementById('fyw').value),
                E: parseFloat(document.getElementById('E').value),
                a_d: parseFloat(document.getElementById('a_d').value)
            };

            try {
                const response = await fetch('http://127.0.0.1:8000/predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(inputs)
                });

                const data = await response.json();
                const capacity = data.shear_capacity_kN;

                // Update capacity
                document.getElementById('capacity-value').textContent = capacity.toFixed(2);

                // Determine failure mode
                const failure = determineFailureMode(capacity, inputs.dwh_d1);
                document.getElementById('failure-mode').textContent = failure.mode;
                document.getElementById('failure-description').textContent = failure.description;

                // Show results
                document.getElementById('results').classList.add('show');

                // Smooth scroll to results
                document.getElementById('results').scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                alert('Backend not running! Start it with:\n\ncd backend\nuvicorn app:app --reload\n\nOr use offline mode with approximate values.');

                // Offline fallback calculation (simplified)
                const approxCapacity = (inputs.d1 * inputs.tw * inputs.fyw / 1000) * (1 - inputs.dwh_d1 * 0.5);
                document.getElementById('capacity-value').textContent = approxCapacity.toFixed(2);

                const failure = determineFailureMode(approxCapacity, inputs.dwh_d1);
                document.getElementById('failure-mode').textContent = failure.mode;
                document.getElementById('failure-description').textContent = failure.description;

                document.getElementById('results').classList.add('show');
                document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Initialize
        updateDimensions();
    </script>
</body>

</html>